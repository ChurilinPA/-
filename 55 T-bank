
1) 

select  user_id,
        sum(case when success_flag = 1 then 1 else 0 end) * 1.0 / count(order_id) as doly,
        sum(case when success_flag = 1 then order_sum) as total_amount
from orders
where date_trunct('month', order_date) = '2024-02-01'
group by user_id

2)

